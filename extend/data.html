<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Working with Data | Flarum Documentation</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/docs/assets/css/0.styles.9a4817a9.css" as="style"><link rel="preload" href="/docs/assets/js/app.2d2bdfc6.js" as="script"><link rel="preload" href="/docs/assets/js/10.cda0d58d.js" as="script"><link rel="prefetch" href="/docs/assets/js/11.84d80c34.js"><link rel="prefetch" href="/docs/assets/js/12.39fe881a.js"><link rel="prefetch" href="/docs/assets/js/13.50cb6f88.js"><link rel="prefetch" href="/docs/assets/js/14.acd375b2.js"><link rel="prefetch" href="/docs/assets/js/15.8f178b07.js"><link rel="prefetch" href="/docs/assets/js/16.8da54367.js"><link rel="prefetch" href="/docs/assets/js/17.a393edcc.js"><link rel="prefetch" href="/docs/assets/js/18.3be6cf7d.js"><link rel="prefetch" href="/docs/assets/js/19.3ad98819.js"><link rel="prefetch" href="/docs/assets/js/2.ae27368c.js"><link rel="prefetch" href="/docs/assets/js/20.1af116b1.js"><link rel="prefetch" href="/docs/assets/js/21.36cdd361.js"><link rel="prefetch" href="/docs/assets/js/22.4aa75a26.js"><link rel="prefetch" href="/docs/assets/js/23.7ef65749.js"><link rel="prefetch" href="/docs/assets/js/24.68c31f06.js"><link rel="prefetch" href="/docs/assets/js/25.e8093458.js"><link rel="prefetch" href="/docs/assets/js/26.9b3d5160.js"><link rel="prefetch" href="/docs/assets/js/27.49731c3e.js"><link rel="prefetch" href="/docs/assets/js/28.088092fe.js"><link rel="prefetch" href="/docs/assets/js/29.aa7e5e8b.js"><link rel="prefetch" href="/docs/assets/js/3.6d766960.js"><link rel="prefetch" href="/docs/assets/js/30.eb665e3e.js"><link rel="prefetch" href="/docs/assets/js/31.689d2ea2.js"><link rel="prefetch" href="/docs/assets/js/32.a392c481.js"><link rel="prefetch" href="/docs/assets/js/33.d2522848.js"><link rel="prefetch" href="/docs/assets/js/34.aa4639d9.js"><link rel="prefetch" href="/docs/assets/js/35.adc1e67d.js"><link rel="prefetch" href="/docs/assets/js/36.491d0cd7.js"><link rel="prefetch" href="/docs/assets/js/37.971f54e4.js"><link rel="prefetch" href="/docs/assets/js/38.9aef59d3.js"><link rel="prefetch" href="/docs/assets/js/4.3303e275.js"><link rel="prefetch" href="/docs/assets/js/5.2f93edc5.js"><link rel="prefetch" href="/docs/assets/js/6.c7dedc4d.js"><link rel="prefetch" href="/docs/assets/js/7.96a508ce.js"><link rel="prefetch" href="/docs/assets/js/8.5a49c366.js"><link rel="prefetch" href="/docs/assets/js/9.eebca368.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.9a4817a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Flarum Documentation</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/docs/extend/" class="nav-link router-link-active">Extend</a></div><div class="nav-item"><a href="https://api.flarum.dev/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API Reference
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Flarum</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://flarum.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://discuss.flarum.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Community
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/flarum/flarum/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/docs/extend/" class="nav-link router-link-active">Extend</a></div><div class="nav-item"><a href="https://api.flarum.dev/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  API Reference
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Flarum</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://flarum.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://discuss.flarum.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Community
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/flarum/flarum/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Main Concepts</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/docs/extend/" class="sidebar-link">Extending Flarum</a></li><li><a href="/docs/extend/start.html" class="sidebar-link">Getting Started</a></li><li><a href="/docs/extend/frontend.html" class="sidebar-link">Frontend Development</a></li><li><a href="/docs/extend/routes.html" class="sidebar-link">Routes and Content</a></li><li><a href="/docs/extend/data.html" class="active sidebar-link">Working with Data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/extend/data.html#migrations" class="sidebar-link">Migrations</a></li><li class="sidebar-sub-header"><a href="/docs/extend/data.html#backend-models" class="sidebar-link">Backend Models</a></li><li class="sidebar-sub-header"><a href="/docs/extend/data.html#serializers" class="sidebar-link">Serializers</a></li><li class="sidebar-sub-header"><a href="/docs/extend/data.html#api-endpoints" class="sidebar-link">API Endpoints</a></li><li class="sidebar-sub-header"><a href="/docs/extend/data.html#frontend-models" class="sidebar-link">Frontend Models</a></li></ul></li><li><a href="/docs/extend/distribution.html" class="sidebar-link">Distribution</a></li><li><a href="/docs/extend/update-b8.html" class="sidebar-link">Updating For Beta 8</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Advanced Guides</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/docs/extend/authorization.html" class="sidebar-link">Authorization</a></li><li><a href="/docs/extend/console.html" class="sidebar-link">Console</a></li><li><a href="/docs/extend/formatting.html" class="sidebar-link">Formatting</a></li><li><a href="/docs/extend/i18n.html" class="sidebar-link">Internationalization</a></li><li><a href="/docs/extend/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/docs/extend/notifications.html" class="sidebar-link">Notifications</a></li><li><a href="/docs/extend/permissions.html" class="sidebar-link">Permissions</a></li><li><a href="/docs/extend/post-types.html" class="sidebar-link">Post Types</a></li><li><a href="/docs/extend/search.html" class="sidebar-link">Search</a></li><li><a href="/docs/extend/settings.html" class="sidebar-link">Settings</a></li><li><a href="/docs/extend/testing.html" class="sidebar-link">Testing</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="working-with-data"><a href="#working-with-data" aria-hidden="true" class="header-anchor">#</a> Working with Data</h1> <p>Data is the foundation of any forum, so you're going to need to play nice with it if you want your extension to do anything useful. This document runs through how data flows in Flarum, from the database to the JSON-API to the frontend, and all the way back again.</p> <p>Flarum makes use of <a href="https://laravel.com/docs/database" target="_blank" rel="noopener noreferrer">Laravel's Database component<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. You should familiarize yourself with it before proceeding, as it is assumed as prior knowledge in the following documentation.</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Many of the APIs described on this page are planned to change in the near future.</p></div> <h2 id="migrations"><a href="#migrations" aria-hidden="true" class="header-anchor">#</a> Migrations</h2> <p>Migrations are like version control for your database, allowing you to easily modify Flarum's database schema in a safe way. Flarum's migrations are very similar to <a href="https://laravel.com/docs/migrations" target="_blank" rel="noopener noreferrer">Laravel's<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, although there are some differences.</p> <p>Migrations live inside a folder suitably named <code>migrations</code> in your extension's  directory. Migrations should be named in the format <code>YYYY_MM_DD_HHMMSS_snake_case_description</code> so that they are listed and run in order of creation.</p> <h3 id="migration-structure"><a href="#migration-structure" aria-hidden="true" class="header-anchor">#</a> Migration Structure</h3> <p>In Flarum, migration files should <strong>return an array</strong> with two functions: <code>up</code> and <code>down</code>. The <code>up</code> function is used to add new tables, columns, or indexes to your database, while the <code>down</code> function should reverse these operations. These functions receive an instance of the <a href="https://laravel.com/docs/5.7/migrations#creating-tables" target="_blank" rel="noopener noreferrer">Laravel schema builder<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which you can use to alter the database schema:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Schema<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'up'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$schema</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// up migration</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'down'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Builder <span class="token variable">$schema</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// down migration</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span></code></pre></div><p>For common tasks like creating a table, or adding columns to an existing table, Flarum provides some helpers which construct this array for you, and take care of writing the <code>down</code> migration logic while they're at it. These are available as static methods on the <code>Flarum\Database\Migration</code> class.</p> <h3 id="creating-tables"><a href="#creating-tables" aria-hidden="true" class="header-anchor">#</a> Creating Tables</h3> <p>To create a table, use the <code>Migration::createTable</code> helper. The <code>createTable</code> helper accepts two arguments. The first is the name of the table, while the second is a <code>Closure</code> which receives a <code>Blueprint</code> object that may be used to define the new table:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Migration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Schema<span class="token punctuation">\</span>Blueprint</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> Migration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When creating the table, you may use any of the schema builder's <a href="https://laravel.com/docs/5.7/migrations#creating-columns" target="_blank" rel="noopener noreferrer">column methods<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to define the table's columns.</p> <h3 id="renaming-tables"><a href="#renaming-tables" aria-hidden="true" class="header-anchor">#</a> Renaming Tables</h3> <p>To rename an existing database table, use the <code>Migration::renameTable</code> helper:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> Migration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">renameTable</span><span class="token punctuation">(</span><span class="token variable">$from</span><span class="token punctuation">,</span> <span class="token variable">$to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="creating-dropping-columns"><a href="#creating-dropping-columns" aria-hidden="true" class="header-anchor">#</a> Creating/Dropping Columns</h3> <p>To add columns to an existing table, use the <code>Migration::addColumns</code> helper. The <code>addColumns</code> helper accepts two arguments. The first is the name of the table. The second is an array of column definitions, with the key being the column name. The value of each item is an array with the column definitions, as understood by Laravel's <code>Illuminate\Database\Schema\Blueprint::addColumn()</code> method. The first value is the column type, and any other keyed values are passed through to <code>addColumn</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> Migration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">addColumns</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'string'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'nullable'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'discussion_count'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'integer'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'unsigned'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To drop columns from an existing table, use the <code>Migration::dropColumns</code> helper, which accepts the same arguments as the <code>addColumns</code> helper. Just like when dropping tables, you should specify the full column definitions so that the migration can be rolled back cleanly.</p> <h3 id="renaming-columns"><a href="#renaming-columns" aria-hidden="true" class="header-anchor">#</a> Renaming Columns</h3> <p>To rename columns, use the <code>Migration::renameColumns</code> helper. The <code>renameColumns</code> helper accepts two arguments. The first is the name of the table, while the second is an array of column names to rename:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> Migration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">renameColumns</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'from'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'to'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="backend-models"><a href="#backend-models" aria-hidden="true" class="header-anchor">#</a> Backend Models</h2> <p>With all your snazzy new database tables and columns, you're going to want a way to access the data in both the backend and the frontend. On the backend it's pretty straightforward – you just need to be familiar with <a href="https://laravel.com/docs/5.7/eloquent" target="_blank" rel="noopener noreferrer">Eloquent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="adding-new-models"><a href="#adding-new-models" aria-hidden="true" class="header-anchor">#</a> Adding New Models</h3> <p>If you've added a new table, you'll need to set up a new model for it. Rather than extending the Eloquent <code>Model</code> class directly, you should extend <code>Flarum\Database\AbstractModel</code> which provides a bit of extra functionality to allow your models to be extended by other extensions.</p> <h3 id="relationships"><a href="#relationships" aria-hidden="true" class="header-anchor">#</a> Relationships</h3> <p>You can add <a href="https://laravel.com/docs/5.7/eloquent-relationships" target="_blank" rel="noopener noreferrer">relationships<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to existing models by listening for the <code>GetModelRelationship</code> event:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Event<span class="token punctuation">\</span>GetModelRelationship</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>User<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>Dispatcher <span class="token variable">$events</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$events</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">listen</span><span class="token punctuation">(</span>GetModelRelationship<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>GetModelRelationship <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isRelationship</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'phone'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">model</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'phone'</span><span class="token punctuation">,</span> Phone<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div> <h2 id="serializers"><a href="#serializers" aria-hidden="true" class="header-anchor">#</a> Serializers</h2> <p>The next step is to expose your new data in Flarum's JSON:API so that it can be consumed by the frontend. You should become familiar with the <a href="https://jsonapi.org/format/" target="_blank" rel="noopener noreferrer">JSON:API specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Flarum's JSON:API layer is powered by the <a href="https://github.com/tobscure/json-api" target="_blank" rel="noopener noreferrer">tobscure/json-api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> library.</p> <p>JSON:API resources are defined by <strong>serializers</strong>. To define a new resource type, create a new serializer class extending <code>Flarum\Api\Serializer\AbstractSerializer</code>. You must specify a resource <code>$type</code> and implement the <code>getDefaultAttributes</code> method which accepts the model instance as its only argument:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Serializer<span class="token punctuation">\</span>AbstractSerializer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Serializer<span class="token punctuation">\</span>UserSerializer</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DiscussionSerializer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSerializer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'discussions'</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getDefaultAttributes</span><span class="token punctuation">(</span><span class="token variable">$discussion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$discussion</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="relationships-2"><a href="#relationships-2" aria-hidden="true" class="header-anchor">#</a> Relationships</h3> <p>You can also specify relationships for your resource. Simply create a new method with the same name as the relation on your model, and return a call to <code>hasOne</code> or <code>hasMany</code> depending on the nature of the relationship. You must pass in the model instance and the name of the serializer to use for the related resources.</p> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token variable">$discussion</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token variable">$discussion</span><span class="token punctuation">,</span> UserSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>To add <strong>attributes</strong> to an existing resource type, listen for the <code>Serializing</code> event:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Event<span class="token punctuation">\</span>Serializing</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Serializer<span class="token punctuation">\</span>UserSerializer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>Dispatcher <span class="token variable">$events</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$events</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">listen</span><span class="token punctuation">(</span>Serializing<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Serializing <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isSerializer</span><span class="token punctuation">(</span>UserSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">attributes</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'firstName'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">first_name</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>To add <strong>relationships</strong> to an existing resource type, listen for the <code>GetApiRelationship</code> event:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Event<span class="token punctuation">\</span>GetApiRelationship</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Serializer<span class="token punctuation">\</span>UserSerializer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>Dispatcher <span class="token variable">$events</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$events</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">listen</span><span class="token punctuation">(</span>GetApiRelationship<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>GetApiRelationship <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isRelationship</span><span class="token punctuation">(</span>UserSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'phone'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">serializer</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">model</span><span class="token punctuation">,</span> PhoneSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div> <h2 id="api-endpoints"><a href="#api-endpoints" aria-hidden="true" class="header-anchor">#</a> API Endpoints</h2> <p>Once you have defined your resources in serializers, you will need to expose them as API endpoints by adding routes and controllers.</p> <p>Following JSON-API conventions, you can add five standard routes for your resource type using the <code>Routes</code> extender:</p> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Extend<span class="token punctuation">\</span>Routes</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'api'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/tags'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'tags.index'</span><span class="token punctuation">,</span> ListTagsController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/tags/{id}'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'tags.show'</span><span class="token punctuation">,</span> ShowTagController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/tags'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'tags.create'</span><span class="token punctuation">,</span> CreateTagController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/tags/{id}'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'tags.update'</span><span class="token punctuation">,</span> UpdateTagController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/tags/{id}'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'tags.delete'</span><span class="token punctuation">,</span> DeleteTagController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre></div><p>The <code>Flarum\Api\Controller</code> namespace contains a number of abstract controller classes that you can extend to easily implement your JSON-API resources.</p> <h3 id="listing-resources"><a href="#listing-resources" aria-hidden="true" class="header-anchor">#</a> Listing Resources</h3> <p>For the controller that lists your resource, extend the <code>Flarum\Api\Controller\AbstractListController</code> class. At a minimum, you need to specify the <code>$serializer</code> you want to use to serialize your models, and implement a <code>data</code> method to return a collection of models. The <code>data</code> method accepts the <code>Request</code> object and the tobscure/json-api <code>Document</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractListController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Message<span class="token punctuation">\</span>ServerRequestInterface</span> <span class="token keyword">as</span> Request<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tobscure<span class="token punctuation">\</span>JsonApi<span class="token punctuation">\</span>Document</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ListTagsController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractListController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$serializer</span> <span class="token operator">=</span> TagSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">data</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> Document <span class="token variable">$document</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Tag<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="showing-a-resource"><a href="#showing-a-resource" aria-hidden="true" class="header-anchor">#</a> Showing a Resource</h3> <p>For the controller that shows a single resource, extend the <code>Flarum\Api\Controller\AbstractShowController</code> class. Like for the list controller, you need to specify the <code>$serializer</code> you want to use to serialize your models, and implement a <code>data</code> method to return a single model:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractShowController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Message<span class="token punctuation">\</span>ServerRequestInterface</span> <span class="token keyword">as</span> Request<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tobscure<span class="token punctuation">\</span>JsonApi<span class="token punctuation">\</span>Document</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ShowTagController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractShowController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$serializer</span> <span class="token operator">=</span> TagSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">data</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> Document <span class="token variable">$document</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">array_get</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> Tag<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="creating-a-resource"><a href="#creating-a-resource" aria-hidden="true" class="header-anchor">#</a> Creating a Resource</h3> <p>For the controller that creates a resource, extend the <code>Flarum\Api\Controller\AbstractCreateController</code> class. This is the same as the show controller, except the response status code will automatically be set to <code>201 Created</code>. You can access the incoming JSON:API document body via <code>$request-&gt;getParsedBody()</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractCreateController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Message<span class="token punctuation">\</span>ServerRequestInterface</span> <span class="token keyword">as</span> Request<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tobscure<span class="token punctuation">\</span>JsonApi<span class="token punctuation">\</span>Document</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CreateTagController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCreateController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$serializer</span> <span class="token operator">=</span> TagSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">data</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> Document <span class="token variable">$document</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$attributes</span> <span class="token operator">=</span> <span class="token function">array_get</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getParsedBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'data.attributes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> Tag<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">array_get</span><span class="token punctuation">(</span><span class="token variable">$attributes</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="updating-a-resource"><a href="#updating-a-resource" aria-hidden="true" class="header-anchor">#</a> Updating a Resource</h3> <p>For the controller that updates a resource, extend the <code>Flarum\Api\Controller\AbstractShowController</code> class. Like for the create controller, you can access the incoming JSON:API document body via <code>$request-&gt;getParsedBody()</code>.</p> <h3 id="deleting-a-resource"><a href="#deleting-a-resource" aria-hidden="true" class="header-anchor">#</a> Deleting a Resource</h3> <p>For the controller that deletes a resource, extend the <code>Flarum\Api\Controller\AbstractDeleteController</code> class. You only need to implement a <code>delete</code> method which enacts the deletion. The controller will automatically return an empty <code>204 No Content</code> response.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractDeleteController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Psr<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Message<span class="token punctuation">\</span>ServerRequestInterface</span> <span class="token keyword">as</span> Request<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DeleteTagController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDeleteController</span>
<span class="token punctuation">{</span>    
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">array_get</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        Tag<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="including-relationships"><a href="#including-relationships" aria-hidden="true" class="header-anchor">#</a> Including Relationships</h3> <p>To include relationships when <strong>listing</strong>, <strong>showing</strong>, or <strong>creating</strong> your resource, specify them in the <code>$include</code> and <code>$optionalInclude</code> properties on your controller:</p> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token comment">// The relationships that are included by default.</span>
    <span class="token keyword">public</span> <span class="token variable">$include</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Other relationships that are available to be included.</span>
    <span class="token keyword">public</span> <span class="token variable">$optionalInclude</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'discussions'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>You can then get a list of included relationships using the <code>extractInclude</code> method. This can be used to eager-load the relationships on your models before they are serialized:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$relations</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">extractInclude</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> Tag<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$relations</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pagination"><a href="#pagination" aria-hidden="true" class="header-anchor">#</a> Pagination</h3> <p>You can allow the number of resources being <strong>listed</strong> to be customized by specifying the <code>limit</code> and <code>maxLimit</code> properties on your controller:</p> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token comment">// The number of records included by default.</span>
    <span class="token keyword">public</span> <span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    
    <span class="token comment">// The maximum number of records that can be requested.</span>
    <span class="token keyword">public</span> <span class="token variable">$maxLimit</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
</code></pre></div><p>You can then extract pagination information from the request using the <code>extractLimit</code> and <code>extractOffset</code> methods:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">extractLimit</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$offset</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">extractOffset</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> Tag<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token variable">$offset</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To add pagination links to the JSON:API document, use the <a href="https://github.com/tobscure/json-api#meta--links" target="_blank" rel="noopener noreferrer"><code>Document::addPaginationLinks</code> method<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="sorting"><a href="#sorting" aria-hidden="true" class="header-anchor">#</a> Sorting</h3> <p>You can allow the sort order of resources being <strong>listed</strong> to be customized by specifying the <code>sort</code> and <code>sortField</code> properties on your controller:</p> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token comment">// The default sort field and order to use.</span>
    <span class="token keyword">public</span> <span class="token variable">$sort</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'asc'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// The fields that are available to be sorted by.</span>
    <span class="token keyword">public</span> <span class="token variable">$sortFields</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'firstName'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'lastName'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>You can then extract sorting information from the request using the <code>extractSort</code> method. This will return an array of sort criteria which you can apply to your query:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$sort</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">extractSort</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$query</span> <span class="token operator">=</span> Tag<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$sort</span> <span class="token keyword">as</span> <span class="token variable">$field</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token function">snake_case</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="extending-api-controllers"><a href="#extending-api-controllers" aria-hidden="true" class="header-anchor">#</a> Extending API Controllers</h3> <p>It is possible to customize all of these options on <em>existing</em> API controllers too by listening for the <code>WillGetData</code> event:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Event<span class="token punctuation">\</span>WillGetData</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>ListDiscussionsController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>Dispatcher <span class="token variable">$events</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$events</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">listen</span><span class="token punctuation">(</span>WillGetData<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>WillGetData <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isController</span><span class="token punctuation">(</span>ListDiscussionsController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setSerializer</span><span class="token punctuation">(</span>MyDiscussionSerializer<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addInclude</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addOptionalInclude</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setLimit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setMaxLimit</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setSort</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'asc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addSortField</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'firstName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div> <p>If you need to do anything else to prepare the data from an existing API controller for serialization, you can do so by listening for the <code>WillSerializeData</code> event:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Event<span class="token punctuation">\</span>WillSerializeData</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Flarum<span class="token punctuation">\</span>Api<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>ListDiscussionsController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span>Dispatcher <span class="token variable">$events</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$events</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">listen</span><span class="token punctuation">(</span>WillSerializeData<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>WillSerializeData <span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isController</span><span class="token punctuation">(</span>ListDiscussionsController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">data</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCustomRelation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div> <h2 id="frontend-models"><a href="#frontend-models" aria-hidden="true" class="header-anchor">#</a> Frontend Models</h2> <p>Now that you have exposed your data in Flarum's JSON:API, it's finally time to bring it to life and consume it on the frontend.</p> <h3 id="fetching-data"><a href="#fetching-data" aria-hidden="true" class="header-anchor">#</a> Fetching Data</h3> <p>Flarum's frontend contains a local data <code>store</code> which provides an interface to interact with the JSON:API. You can retrieve resource(s) from the API using the <code>find</code> method, which always returns a <a href="https://mithril.js.org/archive/v0.2.5/mithril.deferred.html" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// GET /api/discussions?sort=createdAt</span>
app<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'discussions'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>sort<span class="token punctuation">:</span> <span class="token string">'createdAt'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// GET /api/discussions/123</span>
app<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'discussions'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Once resources have been loaded, they will be cached in the store so you can access them again without hitting the API using the <code>all</code> and <code>getById</code> methods:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> discussions <span class="token operator">=</span> app<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'discussions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> discussion <span class="token operator">=</span> app<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token string">'discussions'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The store wraps the raw API resource data in model objects which make it a bit easier to work with. Attributes and relationships can be accessed via pre-defined instance methods:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> id <span class="token operator">=</span> discussion<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> discussion<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> posts <span class="token operator">=</span> discussion<span class="token punctuation">.</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// array of Post models</span>
</code></pre></div><h3 id="adding-new-models-2"><a href="#adding-new-models-2" aria-hidden="true" class="header-anchor">#</a> Adding New Models</h3> <p>If you have added a new resource type, you will need to define a new model for it. Models must extend the <code>Model</code> class and re-define the resource attributes and relationships:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Model <span class="token keyword">from</span> <span class="token string">'flarum/Model'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Tag</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  title <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  createdAt <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">'createdAt'</span><span class="token punctuation">,</span> Model<span class="token punctuation">.</span>transformDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  parent <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token string">'parent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  discussions <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">'discussions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You must then register your new model with the store using the <code>Model</code> extender:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> extend <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Extend<span class="token punctuation">.</span>Model</span><span class="token punctuation">(</span><span class="token string">'tags'</span><span class="token punctuation">,</span> Tag<span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="extending-models"><a href="#extending-models" aria-hidden="true" class="header-anchor">#</a> Extending Models</h3> <p>To add attributes and relationships to existing models, use the <code>Model</code> extender:</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">new</span> <span class="token class-name">Extend<span class="token punctuation">.</span>Model</span><span class="token punctuation">(</span><span class="token string">'discussions'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">'slug'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="saving-resources"><a href="#saving-resources" aria-hidden="true" class="header-anchor">#</a> Saving Resources</h3> <p>To send data back through the API, call the <code>save</code> method on a model instance. This method returns a Promise which resolves with the same model instance:</p> <div class="language-js extra-class"><pre class="language-js"><code>discussion<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'Hello, world!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also save relationships by passing them in a <code>relationships</code> key. For has-one relationships, pass a single model instance. For has-many relationships, pass an array of model instances.</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  relationships<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    groups<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      store<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token string">'groups'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      store<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token string">'groups'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="creating-new-resources"><a href="#creating-new-resources" aria-hidden="true" class="header-anchor">#</a> Creating New Resources</h3> <p>To create a new resource, create a new model instance for the resource type using the store's <code>createRecord</code> method, then <code>save</code> it:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> discussion <span class="token operator">=</span> app<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">createRecord</span><span class="token punctuation">(</span><span class="token string">'discussions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discussion<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'Hello, world!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="deleting-resources"><a href="#deleting-resources" aria-hidden="true" class="header-anchor">#</a> Deleting Resources</h3> <p>To delete a resource, call the <code>delete</code> method on a model instance. This method returns a Promise:</p> <div class="language-js extra-class"><pre class="language-js"><code>discussion<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/flarum/docs/edit/master/docs/extend/data.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/26/2019, 10:02:56 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/extend/routes.html" class="prev">
          Routes and Content
        </a></span> <span class="next"><a href="/docs/extend/distribution.html">
          Distribution
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/10.cda0d58d.js" defer></script><script src="/docs/assets/js/app.2d2bdfc6.js" defer></script>
  </body>
</html>
